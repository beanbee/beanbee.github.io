<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Quick Manual of mysqlbinlog"><meta name="keywords" content="MySQL"><meta name="author" content="Ian"><meta name="copyright" content="Ian"><title>Quick Manual of mysqlbinlog | Beanbee's Blog</title><link rel="shortcut icon" href="/images/favicon.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7d4742d910f55cfca7b3b16d97046c4e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/blog/atom.xml" title="Beanbee's Blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Display-Row-Events"><span class="toc-number">1.</span> <span class="toc-text">Display Row Events</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redo-BINLOG-Changes"><span class="toc-number">2.</span> <span class="toc-text">Redo BINLOG Changes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Extract-SQL-Statements"><span class="toc-number">3.</span> <span class="toc-text">Extract SQL Statements</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Generate-Rollback-SQL"><span class="toc-number">4.</span> <span class="toc-text">Generate Rollback SQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">5.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/favicon.png"></div><div class="author-info__name text-center">Ian</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">21</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">2</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Blogroll</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://kingsamchen.github.io/">kingsamchen</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://madstrawberry.me/">madstrawberry</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://functionghw.is-programmer.com">FunctionGHW</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://blog.51cto.com/ytyzzm">JamesSong</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://sunus.me/">Sunus</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/images/default_top_image_beanbee.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Beanbee's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">Quick Manual of mysqlbinlog</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/workspace/">workspace</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>In case of Database Recovery after unexpected data corruption, list some commonly used scenarios of <em>mysqlbinlog</em> for processing binary log files.</p>
<h1 id="Display-Row-Events"><a href="#Display-Row-Events" class="headerlink" title="Display Row Events"></a>Display Row Events</h1><p>Convert binary events to SQL statements, DDL output will be displayed as a raw statement, DML output will be presented as lines beginning with <code>###</code>, those are “pseudo-SQL” statements which are not executable.</p>
<p>For DML pseudo-SQL statements, they do not correspond exactly to the original SQL statements that generated the events, The original column names are lost and replaced by <code>@*N*</code>, where <em>N</em> is a column number. </p>
<p>Also if you are using multi-character set data, those character set information is not available in the display.</p>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000008</span><br><span class="line">...</span><br><span class="line"><span class="comment"># at 347</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 395 CRC32 0x84460ead     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:195&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 395</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 495 CRC32 0x439d8a47     Query   thread_id=69    exec_time=0     error_code=0</span></span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">create database ghtest</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 495</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 543 CRC32 0x01f37d7c     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:196&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 543</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 727 CRC32 0xd55dfb81     Query   thread_id=69    exec_time=0     error_code=0</span></span><br><span class="line">use `ghtest`/*!*/;</span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">create table gh_ost_test (</span><br><span class="line">  <span class="built_in">id</span> int auto_increment,</span><br><span class="line">  i int not null,</span><br><span class="line">  primary key(<span class="built_in">id</span>)</span><br><span class="line">) auto_increment=1</span><br><span class="line">/*!*/;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># at 727</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 775 CRC32 0x68785572     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:197&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 775</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 849 CRC32 0xc2c7a477     Query   thread_id=69    exec_time=0     error_code=0</span></span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 849</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 906 CRC32 0x77d59f8e     Table_map: `ghtest`.`gh_ost_test` mapped to number 75</span></span><br><span class="line"><span class="comment"># at 906</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 950 CRC32 0x731168d0     Write_rows: table id 75 flags: STMT_END_F</span></span><br><span class="line"><span class="comment">### INSERT INTO `ghtest`.`gh_ost_test`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1</span></span><br><span class="line"><span class="comment">###   @2=0</span></span><br><span class="line"><span class="comment"># at 950</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 981 CRC32 0xc7f39dd9     Xid = 253</span></span><br><span class="line">COMMIT/*!*/;</span><br></pre></td></tr></table></figure>

<h1 id="Redo-BINLOG-Changes"><a href="#Redo-BINLOG-Changes" class="headerlink" title="Redo BINLOG Changes"></a>Redo BINLOG Changes</h1><p>It’s useful for recovery operations by re-executing the output generated by mysqlbinlog, aka Point-in-Time (Incremental) Recovery. Rewrite the command in the last section to generate mysqlbinlog output with BINLOG statements. Each BINLOG statement contains a base 64-encoded string that server decodes to determine the data change indicated by the corresponding event. It requires the <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/privileges-provided.html#priv_super"><code>SUPER</code></a> privilege.</p>
<p>Some pratices below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Output with BINLOG statements</span></span><br><span class="line">$ mysqlbinlog --base64-output=auto -v mysql-bin.000008</span><br><span class="line">...</span><br><span class="line"><span class="comment"># at 495</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 543 CRC32 0x01f37d7c     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:196&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 543</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 727 CRC32 0xd55dfb81     Query   thread_id=69    exec_time=0     error_code=0</span></span><br><span class="line">use `ghtest`/*!*/;</span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">create table gh_ost_test (</span><br><span class="line">  <span class="built_in">id</span> int auto_increment,</span><br><span class="line">  i int not null,</span><br><span class="line">  primary key(<span class="built_in">id</span>)</span><br><span class="line">) auto_increment=1</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 727</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 775 CRC32 0x68785572     GTID [commit=yes]</span></span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:197&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment"># at 775</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 849 CRC32 0xc2c7a477     Query   thread_id=69    exec_time=0     error_code=0</span></span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 849</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 906 CRC32 0x77d59f8e     Table_map: `ghtest`.`gh_ost_test` mapped to number 75</span></span><br><span class="line"><span class="comment"># at 906</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 950 CRC32 0x731168d0     Write_rows: table id 75 flags: STMT_END_F</span></span><br><span class="line"> </span><br><span class="line">BINLOG <span class="string">&#x27;</span></span><br><span class="line"><span class="string">67vOWhPohgMAOQAAAIoDAAAAAEsAAAAAAAEABmdodGVzdAALZ2hfb3N0X3Rlc3QAAgMDAACOn9V3</span></span><br><span class="line"><span class="string">67vOWh7ohgMALAAAALYDAAAAAEsAAAAAAAEAAgAC//wBAAAAAAAAANBoEXM=</span></span><br><span class="line"><span class="string">&#x27;</span>/*!*/;</span><br><span class="line"><span class="comment">### INSERT INTO `ghtest`.`gh_ost_test`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1</span></span><br><span class="line"><span class="comment">###   @2=0</span></span><br><span class="line"><span class="comment"># at 950</span></span><br><span class="line"><span class="comment">#180412  9:52:43 server id 231144  end_log_pos 981 CRC32 0xc7f39dd9     Xid = 253</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">...</span><br><span class="line">  </span><br><span class="line"><span class="comment"># write binary log to a single file and then process the file</span></span><br><span class="line">$ mysqlbinlog --base64-output=auto -v --start-position=2302 mysql-bin.000008 | grep -v <span class="string">&quot;SESSION.GTID_NEXT&quot;</span> &gt; /tmp/mysql-bin-xxx.sql</span><br><span class="line"><span class="comment"># If the statements produced by mysqlbinlog may contain BLOB values, these may cause problems when mysql processes them. In this case, invoke mysql with the --binary-mode option.</span></span><br><span class="line">$ mysql -u xxx -pxxx &lt; /tmp/mysql-bin-xxx.sql</span><br><span class="line">  </span><br><span class="line"><span class="comment"># extract changes of a specific GTID range</span></span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v --include-gtids=951e9bca-204f-11e8-b037-0127be441dc2:1-203 mysql-bin.000008</span><br></pre></td></tr></table></figure>

<p>Please note that I suppressed all <code>SET SESSION.GTID_NEXT</code> statements to make GTID generate automatically, alternatively you can reserve GTID_NEXT info and process them on another instance to make GTID changes exactly same as the instance the binary logs belong, like a replication client.</p>
<h1 id="Extract-SQL-Statements"><a href="#Extract-SQL-Statements" class="headerlink" title="Extract SQL Statements"></a>Extract SQL Statements</h1><p>Sometimes we need to extract the SQL statements as a source file, make changes on some sqls and then process on another instance. there isn’t a built-in way to perform that operation, a workaround as follows and we should extract :</p>
<ol>
<li>Get pseudo-SQL output by providing <em>–base64-output&#x3D;decode-row -v</em> options</li>
<li>Replace @N with their original column names</li>
<li>Remove all the <code>###</code> prefix of the statements</li>
</ol>
<p>Here is an example of extracting sqls from a specific table:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ mysqlbinlog --base64-output=decode-rows  -v mysql-bin.000008 |</span><br><span class="line">                sed -e <span class="string">&#x27;s/###   @1/      id/&#x27;</span> -e <span class="string">&#x27;s/###   @2/,     i/&#x27;</span> |</span><br><span class="line">                sed -e <span class="string">&#x27;s/### //g&#x27;</span> |</span><br><span class="line">                sed <span class="string">&#x27;/i=[0-9]*/s//&amp;;/&#x27;</span> |</span><br><span class="line">                sed -e <span class="string">&#x27;/^#/d&#x27;</span> -e <span class="string">&#x27;/^--$/d&#x27;</span></span><br><span class="line">...</span><br><span class="line">drop database <span class="keyword">if</span> exists ghtest</span><br><span class="line">/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:195&#x27;</span>/*!*/;</span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">create database ghtest</span><br><span class="line">/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:196&#x27;</span>/*!*/;</span><br><span class="line">use `ghtest`/*!*/;</span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">create table gh_ost_test (</span><br><span class="line">  <span class="built_in">id</span> int auto_increment,</span><br><span class="line">  i int not null,</span><br><span class="line">  primary key(<span class="built_in">id</span>)</span><br><span class="line">) auto_increment=1</span><br><span class="line">/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">&#x27;951e9bca-204f-11e8-b037-0127be441dc2:197&#x27;</span>/*!*/;</span><br><span class="line">SET TIMESTAMP=1523497963/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line">INSERT INTO `ghtest`.`gh_ost_test`</span><br><span class="line">SET</span><br><span class="line">      <span class="built_in">id</span>=1</span><br><span class="line">,     i=0;</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="Generate-Rollback-SQL"><a href="#Generate-Rollback-SQL" class="headerlink" title="Generate Rollback SQL"></a>Generate Rollback SQL</h1><p>Like talking on <strong>*Extract SQL Statements</strong>* section, if you want to reverse SQL on binary log files, we have to handle it by cases instead of generating them directly, at least not an easy way to do that now.</p>
<p>However, by the time we need to perform this operation, there’re approaches we can do after the SQL statements been extracted.</p>
<ol>
<li>Extract SQL Statement</li>
<li>replace different DML type for reversing</li>
</ol>
<p>Some examples:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reverse INSERT events</span></span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000010</span><br><span class="line">...</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 313</span></span><br><span class="line"><span class="comment">#180413 13:30:31 server id 231144  end_log_pos 371 CRC32 0x5f85e3c7     Table_map: `ghtest`.`gh_ost_test` mapped to number 78</span></span><br><span class="line"><span class="comment"># at 371</span></span><br><span class="line"><span class="comment">#180413 13:30:31 server id 231144  end_log_pos 419 CRC32 0x436c5ecf     Write_rows: table id 78 flags: STMT_END_F</span></span><br><span class="line"><span class="comment">### INSERT INTO `ghtest`.`gh_ost_test`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=6</span></span><br><span class="line"><span class="comment">###   @2=0</span></span><br><span class="line"><span class="comment"># at 419</span></span><br><span class="line"><span class="comment">#180413 13:30:31 server id 231144  end_log_pos 450 CRC32 0x2f186b8b     Xid = 694</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">...</span><br><span class="line">  </span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000010 | grep -A 4 <span class="string">&#x27;### INSERT INTO&#x27;</span> |</span><br><span class="line">                sed -e <span class="string">&#x27;s/### INSERT INTO/DELETE FROM/&#x27;</span> -e <span class="string">&#x27;s/### SET/WHERE/&#x27;</span> |</span><br><span class="line">                sed -e <span class="string">&#x27;s/###   @1/      id/&#x27;</span> -e <span class="string">&#x27;s/###   @2/,     i/&#x27;</span> |</span><br><span class="line">                sed <span class="string">&#x27;/i=[0-9]*/s//&amp;;/&#x27;</span></span><br><span class="line">DELETE FROM `ghtest`.`gh_ost_test`</span><br><span class="line">WHERE</span><br><span class="line">      <span class="built_in">id</span>=6</span><br><span class="line">,     i=0;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># Reverse DELETE events</span></span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000010 | grep -A 4 <span class="string">&#x27;### DELETE FROM&#x27;</span> |</span><br><span class="line">              sed -e <span class="string">&#x27;s/### DELETE FROM/INSERT INTO/&#x27;</span> -e <span class="string">&#x27;s/### WHERE/SET/&#x27;</span>|</span><br><span class="line">              sed -e <span class="string">&#x27;s/###   @1/      id/&#x27;</span> -e <span class="string">&#x27;s/###   @2/,     i/&#x27;</span> |</span><br><span class="line">              sed <span class="string">&#x27;/i=[0-9]*/s//&amp;;/&#x27;</span></span><br><span class="line">INSERT INTO `ghtest`.`gh_ost_test`</span><br><span class="line">SET</span><br><span class="line">      <span class="built_in">id</span>=4</span><br><span class="line">,     i=1;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># Reverse UPDATE events</span></span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000010</span><br><span class="line">...</span><br><span class="line"><span class="comment"># at 498</span></span><br><span class="line"><span class="comment">#180413 13:30:47 server id 231144  end_log_pos 572 CRC32 0x002c4eae     Query   thread_id=80    exec_time=0 error_code=0</span></span><br><span class="line">SET TIMESTAMP=1523597447/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line"><span class="comment"># at 572</span></span><br><span class="line"><span class="comment">#180413 13:30:47 server id 231144  end_log_pos 630 CRC32 0x1ec396c8     Table_map: `ghtest`.`gh_ost_test` mapped to number 78</span></span><br><span class="line"><span class="comment"># at 630</span></span><br><span class="line"><span class="comment">#180413 13:30:47 server id 231144  end_log_pos 692 CRC32 0x8a24569e     Update_rows: table id 78 flags: STMT_END_F</span></span><br><span class="line"><span class="comment">### UPDATE `ghtest`.`gh_ost_test`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=3</span></span><br><span class="line"><span class="comment">###   @2=2</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=3</span></span><br><span class="line"><span class="comment">###   @2=3</span></span><br><span class="line"><span class="comment"># at 692</span></span><br><span class="line"><span class="comment">#180413 13:30:47 server id 231144  end_log_pos 723 CRC32 0x7bcddc40     Xid = 695</span></span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">...</span><br><span class="line">  </span><br><span class="line">$ mysqlbinlog --base64-output=decode-rows -v mysql-bin.000010 | grep -A 8 <span class="string">&#x27;### UPDATE&#x27;</span> |</span><br><span class="line">              sed -e <span class="string">&#x27;s/### UPDATE/UPDATE/&#x27;</span> | sed -e <span class="string">&#x27;s/### SET/WHERE/&#x27;</span> | sed -e <span class="string">&#x27;s/### WHERE/SET/&#x27;</span> |</span><br><span class="line">              sed -e <span class="string">&#x27;s/###   @1/      id/&#x27;</span> -e <span class="string">&#x27;s/###   @2/,     i/&#x27;</span> |</span><br><span class="line">              sed  -e <span class="string">&#x27;/WHERE/&#123;n;n;s|$|;|&#125;&#x27;</span></span><br><span class="line">...</span><br><span class="line">UPDATE `ghtest`.`gh_ost_test`</span><br><span class="line">SET</span><br><span class="line">      <span class="built_in">id</span>=3</span><br><span class="line">,     i=2</span><br><span class="line">WHERE</span><br><span class="line">      <span class="built_in">id</span>=3</span><br><span class="line">,     i=3;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog.html">https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-row-events.html">https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-row-events.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/point-in-time-recovery.html">https://dev.mysql.com/doc/refman/5.6/en/point-in-time-recovery.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-backup.html">https://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-backup.html</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://beanbee.github.io/blog/2018/quick-maunal-myqlbinlog/">https://beanbee.github.io/blog/2018/quick-maunal-myqlbinlog/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2018/ghost-cut-over-steps/"><i class="fa fa-chevron-left">  </i><span>gh-ost无损cut-over方案</span></a></div><div class="next-post pull-right"><a href="/blog/2016/usage-database-sql-golang/"><span>database/sql包使用须知</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://beanbee.github.io/blog/2018/quick-maunal-myqlbinlog/';
  this.page.identifier = 'blog/2018/quick-maunal-myqlbinlog/';
  this.page.title = 'Quick Manual of mysqlbinlog';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'beanbee' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div><footer class="footer-bg" style="background-image: url(/images/default_top_image_beanbee.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By Ian</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>